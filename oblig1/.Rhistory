" - norway_pisa_science.json\n",
" - norway_pisa_science_records.json\n",
" - norway_pisa_science.ndjson\n")
# --- packages ---
library(jsonlite)
# --- OWID API URLs (Norway, filtered) ---
data_url <- "https://ourworldindata.org/grapher/pisa-test-score-mean-performance-on-the-reading-scale.csv?v=1&csvType=filtered&useColumnShortNames=true&tab=line&country=~NOR"
meta_url <- "https://ourworldindata.org/grapher/pisa-test-score-mean-performance-on-the-reading-scale.metadata.json?v=1&csvType=filtered&useColumnShortNames=true&tab=line&country=~NOR"
# --- fetch ---
df <- read.csv(data_url, check.names = FALSE)
metadata <- jsonlite::fromJSON(meta_url)
# --- detect the value column (PISA reading score) ---
cands <- setdiff(names(df), c("Entity","Code","Year","Date","Day"))
pref  <- cands[grepl("pisa.*reading|reading.*average|pisa_reading", cands, ignore.case = TRUE)]
val_col <- if (length(pref)) pref[1] else cands[1]
stopifnot(!is.na(val_col), nchar(val_col) > 0)
# --- choose date-like column (OWID usually uses 'Year') ---
date_col <- if ("Year" %in% names(df)) "Year" else if ("Date" %in% names(df)) "Date" else "Day"
# --- Norway only, keep relevant columns ---
keep <- unique(c("Entity","Code", date_col, val_col))
nor <- subset(df, Entity == "Norway", select = keep)
# --- standardize names ---
names(nor)[names(nor) == date_col] <- "year"
names(nor)[names(nor) == val_col]  <- "pisa_reading_score"
# coerce types & sort
nor$year <- as.integer(nor$year)
nor$pisa_reading_score <- as.numeric(nor$pisa_reading_score)
nor <- nor[order(nor$year), ]
# basic quality flag
nor$is_missing <- is.na(nor$pisa_reading_score)
# --- compact metadata for the bundle ---
`%||%` <- function(a, b) if (!is.null(a) && length(a)) a else b
citation_text <- paste0(
"Source: OECD (2023) – with minor processing by Our World in Data. ",
"Indicator: average PISA reading score for 15-year-olds (OECD scale; mean=500, SD=100 in base year)."
)
meta_compact <- list(
title       = metadata$title %||% "Average performance of 15-year-olds in reading (PISA)",
variable    = "pisa_reading_score",
unit        = metadata$unit %||% "PISA score",
description = metadata$description %||% NULL,
owidTags    = metadata$owidTags %||% NULL,
dataPublishedBy    = metadata$dataPublishedBy %||% NULL,
dataPublisherSource = metadata$dataPublisherSource %||% NULL,
lastUpdated = metadata$lastUpdated %||% NULL,
retrieved   = as.character(Sys.Date()),
source_and_citation = citation_text,
notes = "Scores calibrated to maintain comparability across cycles; see OECD/OWID notes for details."
)
records <- nor[, c("Entity","Code","year","pisa_reading_score","is_missing")]
bundle <- list(
dataset = "pisa-test-score-mean-performance-on-the-reading-scale (OECD; OWID processed)",
country = "Norway",
metadata = meta_compact,
data = records
)
# --- write JSON artifacts (UTF-8) ---
jsonlite::write_json(bundle,  "norway_pisa_reading.json",         pretty = TRUE, auto_unbox = TRUE)
jsonlite::write_json(records, "norway_pisa_reading_records.json", pretty = TRUE, auto_unbox = TRUE)
# --- NDJSON (one line per year) ---
con <- file("norway_pisa_reading.ndjson", open = "w", encoding = "UTF-8")
apply(records, 1, function(row) writeLines(jsonlite::toJSON(as.list(row), auto_unbox = TRUE), con = con))
close(con)
cat("Wrote:\n",
" - norway_pisa_reading.json\n",
" - norway_pisa_reading_records.json\n",
" - norway_pisa_reading.ndjson\n")
cls
library(tidyverse)
setwd("C:/Users/ofurn/Dokumenter/Github/stk3100/oblig1")
wingspan <- read_file("data/wingspan.txt")
wingspan
library(tidyverse)
wingspan <- read.table("data/wingspan.txt",
header = TRUE)
wingspan
# f)
library(tidyverse)
wingspan <- read.table("data/wingspan.txt",
header = TRUE)
wingspan
M0 <- lm(Wingspan~0+Height,
data = wingspan)
M1 = lm(Wingspan~Height,
data = wingspan)
anova(M0,M1)
library(tidyverse)
titanic <- read.table("data/titanic.txt",
header = TRUE)
titanic
glm(survived~pclass,
data = titanic,
family = binomial) %>%
summary()
glm(survived~pclass+age,
data = titanic,
family = binomial) %>%
summary()
cls
glm(survived~pclass+age,
data = titanic,
family = binomial) %>%
summary()
summary(M1)
summary(M1)$coefficients["age",]
M1 <- glm(survived~pclass+age, data = titanic, family = binomial) %>%
summary()
M1$coefficients["age",]
M0 <- glm(survived~pclass, data = titanic, family = binomial)
M1 <- glm(survived~pclass+age, data = titanic, family = binomial)
wald <- summary(M1)$coefficients["age",]
wald
lrt <- anova(M0,M1,test = "Chisq")
lrt
install.packages("RcmdrMisc")
library(RcmdrMisc)
score
library(RcmdrMisc)
score <- RaoScore.test(M0, "age")
cls
library(car)
score <- car::Anova(M0,test="Rao")
library(RcmdrMisc)
score <- car::Anova(M0,test="Rao")
install.packages("RcmdrMisc", dependencies=TRUE)
# 2
library(tidyverse)
# a)
titanic <- read.table("data/titanic.txt",
header = TRUE)
titanic
glm(survived~pclass,
data = titanic,
family = binomial) %>%
summary()
# c)
glm(survived~pclass+age,
data = titanic,
family = binomial) %>%
summary()
# d)
M0 <- glm(survived~pclass, data = titanic, family = binomial)
M1 <- glm(survived~pclass+age, data = titanic, family = binomial)
wald <- summary(M1)$coefficients["age",]
wald
lrt <- anova(M0,M1,test = "Chisq")
lrt
library(car)
library(RcmdrMisc)
score <- car::Anova(M0,test="Rao")
M0 <- glm(survived~pclass, data = titanic, family = binomial)
M1 <- glm(survived~pclass+age, data = titanic, family = binomial)
wald <- summary(M1)$coefficients["age",]
wald
lrt <- anova(M0,M1,test = "Chisq")
lrt
M0 <- glm(survived~pclass, data = titanic, family = binomial)
M1 <- glm(survived~pclass+age, data = titanic, family = binomial)
M0 <- glm(survived~pclass, data = titanic, family = binomial)
M1 <- glm(survived~pclass+age, data = titanic, family = binomial)
M0 %>% confint()
M0 %>% confint()
M1 %>% confint()
M0 %>% confint()
M1 %>% confint()
M0 %>% confint() %>% exp()
M1 %>% confint() %>% exp()
cls
library(tidyverse)
setwd("C:/Users/ofurn/Dokumenter/Github/stk1110/oblig1")
forsikringskrav <- read.table("data/forsikringskrav.txt",
header = TRUE)
forsikringskrav
forsikringskrav <- read.table("data/forsikringskrav.txt", header = TRUE) %>% as_tibble()
forsikringskrav
forsikringskrav <- read.table("data/forsikringskrav.txt") %>%
as_tibble()
forsikringskrav
x <- read.table("data/forsikringskrav.txt") %>%
as_tibble()
x
forsikringskrav <- read.table("data/forsikringskrav.txt") %>%
as_tibble()
forsikringskrav <- read.table("data/forsikringskrav.txt") %>% as_tibble()
x <- mean(forsikringskrav)
s2 <- mean((forsikringskrav-x)^2)
x <- mean(forsikringskrav)
x <- mean(forsikringskrav$V1)
x <- scan("data/forsikringskrav.txt")
x
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x-xb)^2)
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x-xb)^2)
alpha <- xb^2/s2
gamma <- xb/s2
beta <- s2(xb)
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x-xb)**2)
alpha <- xb**2/s2
gamma <- xb/s2
beta <- s2(xb)
s2 <- mean((x-xb)**2)
s2 <- mean((x-xb)^2)
s2
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x-xb)^2)
alpha <- xb^2/s2
gamma <- xb/s2
beta <- s2/xb
alpha
gamma
beta
xb
s2
alpha
gamma
beta
n <- length(x)
n
logL <- n*alpha*log(gamma)-n*lgamma(alpha)+(alpha-1)*sum(log(x))-gamma*sum(x)
logL
n
logL
negloglikgamma = function(logalpha, x=x)
{
n = length(x)
alpha = exp(logalpha)
gamma = alpha/mean(x)
logL = n*alpha*log(gamma)-n*lgamma(alpha)+(alpha-1)*sum(log(x))-gamma*sum(x)-logL
}
fit.ml = optim(log(alpha0), negloglikgamma, x=x, method = "BFGS")
alpha0 = xb^2/s2
gamma0 = xb/s2
negloglikgamma = function(logalpha, x=x)
{
n = length(x)
alpha = exp(logalpha)
gamma = alpha/mean(x)
logL = n*alpha*log(gamma)-n*lgamma(alpha)+(alpha-1)*sum(log(x))-gamma*sum(x)-logL
}
fit.ml = optim(log(alpha0), negloglikgamma, x=x, method = "BFGS")
alpha_mle = fit.ml$par %>% exp()
alpha_mle
gamma_mle = alpha_mle/xb
logL_mle = -fit.ml$value
alpha0 = xb^2/s2
gamma0 = xb/s2
negloglikgamma = function(logalpha, x=x)
{
n = length(x)
alpha = exp(logalpha)
gamma = alpha/mean(x)
logL = n*alpha*log(gamma)-n*lgamma(alpha)+(alpha-1)*sum(log(x))-gamma*sum(x)-logL
}
fit.ml = optim(log(alpha0), negloglikgamma, x=x, method = "BFGS")
alpha_mle = fit.ml$par %>% exp()
gamma_mle = alpha_mle/xb
logL_mle = -fit.ml$value
alpha_mle
gamma_mle
logL_mle
print(logL_mle, logL)
alpha0 = xb^2/s2
gamma0 = xb/s2
negloglikgamma = function(logalpha, x=x)
{
n = length(x)
alpha = exp(logalpha)
gamma = alpha/mean(x)
logL = n*alpha*log(gamma)-n*lgamma(alpha)+(alpha-1)*sum(log(x))-gamma*sum(x)-logL
}
fit.ml = optim(log(alpha0), negloglikgamma, x=x, method = "BFGS")
alpha_mle = fit.ml$par %>% exp()
gamma_mle = alpha_mle/xb
logL_mle = -fit.ml$value
alpha_mle
gamma_mle
logL_mle
logL
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x - xb)^2)
alpha0 <- xb^2/s2
gamma0 <- xb/s2
negloglikgamma <- function(logalpha, x = x)
{
n <- length(x)
alpha <- exp(logalpha)
gamma <- alpha / mean(x)  # MLE for gamma gitt alpha
logL <- n*alpha*log(gamma) - n*lgamma(alpha) +
(alpha - 1)*sum(log(x)) - gamma*sum(x)
-logL                       # returnér negativ logL
}
fit.ml <- optim(log(alpha0), negloglikgamma, x = x, method = "BFGS")
alpha_mle <- exp(fit.ml$par)
gamma_mle <- alpha_mle / xb
logL_mle  <- -fit.ml$value
alpha_mle
gamma_mle
logL_mle
logL
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x - xb)^2)
alpha0 <- xb^2/s2
gamma0 <- xb/s2
negloglikgamma <- function(logalpha, x = x)
{
n <- length(x)
alpha <- exp(logalpha)
gamma <- alpha / mean(x)  # MLE for gamma gitt alpha
logL <- n*alpha*log(gamma) - n*lgamma(alpha) +
(alpha - 1)*sum(log(x)) - gamma*sum(x)
-logL                       # returnér negativ logL
}
fit.ml <- optim(log(alpha0), negloglikgamma, x = x, method = "BFGS")
alpha_mle <- exp(fit.ml$par)
gamma_mle <- alpha_mle / xb
logL_mle  <- -fit.ml$value
alpha_mle
gamma_mle
logL_mle
logL
cls
x <- scan("data/forsikringskrav.txt")
xb <- mean(x)
s2 <- mean((x - xb)^2)
negloglikgamma <- function(logalpha, x) {
n <- length(x)
alpha <- exp(logalpha)
gamma <- alpha / mean(x)
logL <- n*alpha*log(gamma) - n*lgamma(alpha) +
(alpha - 1)*sum(log(x)) - gamma*sum(x)
-logL
}
mle_ag <- function(x) {
xb <- mean(x); s2 <- mean((x - xb)^2)
alpha0 <- xb^2 / s2
fit <- optim(log(alpha0), negloglikgamma, x = x, method = "BFGS")
alpha <- exp(fit$par)
gamma <- alpha / xb
c(alpha = alpha, gamma = gamma)
}
# point estimates (MLE)
ag_hat <- mle_ag(x)
alpha_hat <- ag_hat["alpha"]
gamma_hat <- ag_hat["gamma"]
# bootstrap
set.seed(1705)
B <- 2000
boot_ag <- replicate(B, {
x_b <- sample(x, length(x), replace = TRUE)
mle_ag(x_b)
})
alpha_se <- sd(boot_ag["alpha", ])
gamma_se <- sd(boot_ag["gamma", ])
alpha_ci <- quantile(boot_ag["alpha", ], c(0.025, 0.975))
gamma_ci <- quantile(boot_ag["gamma", ], c(0.025, 0.975))
alpha_hat
gamma_hat
alpha_se
gamma_se
alpha_ci
gamma_ci
fit.ml <- optim(log(alpha0), negloglikgamma, x = x, method = "BFGS")
set.seed(1705)
B <- 2000
boot <- replicate(B, {
xb_ <- mean(xb <- sample(x, n, TRUE))
s2_ <- mean((xb - xb_)^2)
a0  <- xb_^2 / s2_
a   <- exp(optim(log(a0), negloglikgamma, x = xb, method = "BFGS")$par)
c(alpha = a, gamma = a / xb_)
})
alpha_se <- sd(boot["alpha", ])
gamma_se <- sd(boot["gamma", ])
alpha_ci <- quantile(boot["alpha", ], c(.025, .975))
gamma_ci <- quantile(boot["gamma", ], c(.025, .975))
alpha_se
gamma_se
alpha_ci
gamma_ci
set.seed(1705)
B <- 2000
mu_hat <- mean(x)
mu_boot <- replicate(B, mean(sample(x, n, TRUE)))
mu_ci <- quantile(mu_boot, c(.025, .975))
mu_hat
mu_ci
# decisions via CI inclusion of 25
rej_05 <- !(25 >= mu_ci[1] & 25 <= mu_ci[2])
rej_01 <- !(25 >= quantile(mu_boot, c(.005, .995))[1] &
25 <= quantile(mu_boot, c(.005, .995))[2])
rej_05
rej_01
library(tidyverse)
df = data.frame(525,587,547,558,591,531,571,551,566,622,561,502,556,565,562)
df
x <- c(525,587,547,558,591,531,571,551,566,622,561,502,556,565,562)
x
x <- c(525,587,547,558,591,531,571,551,566,622,561,502,556,565,562)
n <- length(x)
xb <- mean(x)
s <- sd(x)
tcrit <- qt(.975, df = n-1)
lo <- xb - tcrit * s / sqrt(n)
hi <- xb + tcrit * s / sqrt(n)
xb
s
lo
hi
set.seed(1705)
B <- 10000
n <- 15
mu <- 558
sigma <- 30
cov <- replicate(B, {
y <- rnorm(n, mu, sigma)
xb <- mean(y); s <- sd(y)
tcrit <- qt(.975, df = n - 1)
lo <- xb - tcrit * s / sqrt(n); hi <- xb + tcrit * s / sqrt(n)
(mu >= lo) & (mu <= hi)
})
cover <- mean(cov)
se_mc <- sqrt(cover * (1 - cover) / B)
cover
se_mc
set.seed(1705)
cov_z <- replicate(B, {
y <- rnorm(n, mu, sigma)
xb <- mean(y); s <- sd(y)
lo <- xb - 1.96 * s / sqrt(n); hi <- xb + 1.96 * s / sqrt(n)
(mu >= lo) & (mu <= hi)
})
cover_z <- mean(cov_z)
se_mc_z <- sqrt(cover_z * (1 - cover_z) / B)
cover_z; se_mc_z
set.seed(1705)
cov_z <- replicate(B, {
y <- rnorm(n, mu, sigma)
xb <- mean(y); s <- sd(y)
lo <- xb - 1.96 * s / sqrt(n); hi <- xb + 1.96 * s / sqrt(n)
(mu >= lo) & (mu <= hi)
})
cover_z <- mean(cov_z)
se_mc_z <- sqrt(cover_z * (1 - cover_z) / B)
cover_z; se_mc_z
set.seed(1705)
cov_z <- replicate(B, {
y <- rnorm(n, mu, sigma)
xb <- mean(y)
s <- sd(y)
lo <- xb - 1.96 * s / sqrt(n)
hi <- xb + 1.96 * s / sqrt(n)
(mu >= lo) & (mu <= hi)
})
cover_z <- mean(cov_z)
se_mc_z <- sqrt(cover_z * (1 - cover_z) / B)
cover_z; se_mc_z
set.seed(1705)
cov_z <- replicate(B, {
y <- rnorm(n, mu, sigma)
xb <- mean(y)
s <- sd(y)
lo <- xb - 1.96 * s / sqrt(n)
hi <- xb + 1.96 * s / sqrt(n)
(mu >= lo) & (mu <= hi)
})
cover_z <- mean(cov_z)
se_mc_z <- sqrt(cover_z * (1 - cover_z) / B)
cover_z; se_mc_z
set.seed(1705)
cov_sigma <- replicate(B, {
y <- rnorm(n, mu, sigma)
s <- sd(y)
lo <- sqrt((n - 1) * s^2 / qchisq(.975, df = n - 1))
hi <- sqrt((n - 1) * s^2 / qchisq(.025, df = n - 1))
(sigma >= lo) & (sigma <= hi)
})
cover_sigma <- mean(cov_sigma)
se_mc_sigma <- sqrt(cover_sigma * (1 - cover_sigma) / B)
cover_sigma; se_mc_sigma
set.seed(1705)
cov_t7 <- replicate(B, {
z <- rt(n, df = 7)
y <- mu + sigma * z
xb <- mean(y)
s <- sd(y)
tcrit <- qt(.975, df = n - 1)
lo <- xb - tcrit * s / sqrt(n); hi <- xb + tcrit * s / sqrt(n)
(mu >= lo) & (mu <= hi)
})
cover_t7 <- mean(cov_t7)
se_mc_t7 <- sqrt(cover_t7 * (1 - cover_t7) / B)
cover_t7; se_mc_t7
set.seed(1705)
tilde_sigma <- sqrt(1.4) * sigma
cov_t7_sigma <- replicate(B, {
y <- mu + sigma * rt(n, df = 7)
s <- sd(y)
lo <- sqrt((n - 1) * s^2 / qchisq(.975, df = n - 1))
hi <- sqrt((n - 1) * s^2 / qchisq(.025, df = n - 1))
(tilde_sigma >= lo) & (tilde_sigma <= hi)
})
cover_t7_sigma <- mean(cov_t7_sigma)
se_mc_t7_sigma <- sqrt(cover_t7_sigma * (1 - cover_t7_sigma) / B)
cover_t7_sigma; se_mc_t7_sigma
